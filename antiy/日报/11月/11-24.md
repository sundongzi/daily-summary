##### gitlab-ci构建速度优化

1. 缓存`node_modules`与`dist`目录

   ```yaml
   cache:
     key: $CI_COMMIT_REF_NAME
     paths:
       - node_modules/
       - dist/
   ```

2. 限制`npm install`执行，但是每次会清除node_modules以及dist文件

   ```yaml
   cache:
     key: $CI_COMMIT_REF_NAME
     paths:
       - node_modules/
       - dist/
   # 阶段
   stages:
     - install
     - build
     - deploy
     
    # 安装依赖
   install:
     stage: install
     tags:
      - deploy
     # 规定仅在package.json提交时才触发
     only:
       changes:
         - package.json
     # 执行脚本
     script:
       yarn
   ```

3. 缓存+指定文件+初始化缓存判断

   - cache进行缓存

   - only-changes指定哪些文件改变后重新安装依赖

   - 如果手动把缓存清理或者初始化构建，会先进行缓存判断

     ```yaml
     script:
         - |
           if [ ! -e "node_modules/" ]; then
             echo "Cache miss! Installing dependencies with npm install."
             npm install
           else
             echo "Cache hit! Reusing dependencies from cache."
           fi
         - npm run build
         # 通过Dockerfile生成镜像
         - docker build -t cloud/agentfront_dev1.6 .
         - docker tag cloud/agentfront_dev1.6:latest 10.250.125.34:30800/cloud/agentfront_dev1.6:latest
         # 推送镜像到仓库
         - docker push 10.250.125.34:30800/cloud/agentfront_dev1.6:latest
         - echo "--------------------front push over------------------"
     ```

     



##### 如何清理runner缓存

原则上：每次安装依赖或者版本发生变化时可以手动清除缓存

<img src="/Users/sundong/Library/Application Support/typora-user-images/image-20231124162359771.png" alt="image-20231124162359771" style="zoom:50%;" />

##### 工作

1. 应用监控-配置Bug修改
2. 日志下载功能调整
3. 数字格式化功能调整