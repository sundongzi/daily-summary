<img src="/Users/sundong/Library/Application Support/typora-user-images/image-20230201111422963.png" alt="image-20230201111422963" style="zoom:50%;" />

浏览器

##### 进程

定义：具有独立的内存空间和系统资源，是操作系统调度和管理的基本单位。多个进程之间不会互相影响。

分类：

- 浏览器进程

  主要负责界面展示、用户交互、子进程管理等等。浏览器进程内部会启动多个线程处理不同的任务

- 网络进程

  负责加载网络资源，同时会启动多个线程来处理不同的网络任务

- 渲染进程

  当它启动后，会开启一个渲染主线程，主线程负责执行 HTML、CSS、JS代码

- ...

##### 线程

定义：线程是进程内的一个独立执行单位，能够独立执行代码，多个线程可以共享同一个进程中的资源。

##### JS单线程

执行栈：渲染主进程

任务队列

- 循环执行
- 先进先出
- 存在优先级

##### 异步任务

交给其他线程处理，继续执行后续代码，等其他线程完成后，讲该任务添加给任务队列中，等待执行。

##### 任务没有优先级，只是区分是同步任务还是异步任务

##### 消息队列存在优先级

- 每个任务都有一个任务类型，同一个类型的任务必须在一个队列，不同类型的任务可以分属于不同的队列。
- 在一次事件循环中，浏览器可以根据实际情况从不同的队列中取出任务执行。
- 浏览器[必须准备好一个微队列](https://link.juejin.cn/?target=https%3A%2F%2Fhtml.spec.whatwg.org%2Fmultipage%2Fwebappapis.html%23perform-a-microtask-checkpoint)，**而且微队列中的任务优先所有其他任务执行**

##### 消息队列类型

目前在chrome的实现中，至少包含以下几种队列：

- 微队列：用户存放需要最快执行的任务，优先级「最高」
- 交互队列：用于存放用户操作后产生的事件处理任务，优先级「高」
- 延时队列：用于存放计时器到达后的回调任务，优先级「中」

之所以摒弃原本一个宏任务队列+多个微任务的队列的设计，是因为随着浏览器的复杂度急剧提升，使用宏任务过于笼统。
例如我们上文说的，定时器和点击事件同时触发，谁先执行，简单的使用宏任务就无法区分。

##### 总结

事件循环是浏览器渲染进程的主要方式，每次循环从任务队列中取出第一个任务执行，而其他线程只需要在合适的时机将任务添加到不同的任务队列中去。

每个任务都有不同的类型，将同类型的任务放到同一队列中，不同类型的任务放在不同的队列中去。需要注意的是`任务没有优先级，但任务队列存在优先级，微任务队列的优先级最高`。

##### 参考链接

[我自己理解的事件循环，如果不对，请多指教🙇](https://juejin.cn/post/7232552216376295484#comment)

